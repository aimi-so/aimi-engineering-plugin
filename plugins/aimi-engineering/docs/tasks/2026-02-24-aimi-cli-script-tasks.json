{
  "schemaVersion": "2.0",
  "metadata": {
    "title": "feat: Add aimi-cli.sh script",
    "type": "feat",
    "branchName": "feat/aimi-cli-script",
    "createdAt": "2026-02-24",
    "planPath": "docs/plans/2026-02-24-aimi-cli-script-plan.md"
  },
  "userStories": [
    {
      "id": "US-001",
      "title": "Create core script structure",
      "description": "As a developer, I need the base aimi-cli.sh script with subcommand routing so that all commands have a consistent entry point.",
      "acceptanceCriteria": [
        "Script exists at scripts/aimi-cli.sh with executable permissions",
        "Subcommand routing via case statement handles all commands",
        "help command displays all available commands",
        "jq dependency check with helpful error message if missing",
        "Exit codes: 0=success, 1=error",
        "Error messages written to stderr"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement state management functions",
      "description": "As a developer, I need functions to manage state files in .aimi/ directory so that execution context persists across /clear.",
      "acceptanceCriteria": [
        "ensure_state_dir() creates .aimi/ if not exists",
        "read_state(key) reads from .aimi/$key (returns empty if not exists)",
        "write_state(key, value) writes to .aimi/$key",
        "clear_state_file(key) removes single state file",
        "get_tasks_file() helper returns cached or discovered tasks file"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Implement find-tasks command",
      "description": "As a developer, I need a command to find the most recent tasks file so that dynamic filename discovery is centralized.",
      "acceptanceCriteria": [
        "Returns path to most recent *-tasks.json file in docs/tasks/",
        "Returns exit code 1 if no tasks file found",
        "Outputs path to stdout on success"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement init-session command",
      "description": "As a developer, I need an init-session command to set up execution state so that story-by-story execution can resume after /clear.",
      "acceptanceCriteria": [
        "Finds tasks file using find-tasks (or errors if none)",
        "Saves tasks file path to .aimi/current-tasks",
        "Extracts and saves branchName to .aimi/current-branch",
        "Validates branchName matches ^[a-zA-Z0-9][a-zA-Z0-9/_-]*$",
        "Outputs JSON: {tasks, branch, pending}"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement status command",
      "description": "As a developer, I need a status command to get comprehensive progress summary as JSON.",
      "acceptanceCriteria": [
        "Uses cached tasks file from state (or discovers if no state)",
        "Returns JSON with: title, branch, pending, completed, skipped, total",
        "Includes stories array with: id, title, passes, skipped, notes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement next-story command",
      "description": "As a developer, I need a next-story command to get the next pending story and save to state.",
      "acceptanceCriteria": [
        "Returns next pending story (lowest priority, passes=false, skipped!=true)",
        "Saves story ID to .aimi/current-story",
        "Returns null if no pending stories",
        "Outputs full story JSON: id, title, description, acceptanceCriteria, priority"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Implement current-story command",
      "description": "As a developer, I need a current-story command to get the currently active story from state.",
      "acceptanceCriteria": [
        "Reads story ID from .aimi/current-story",
        "Returns full story JSON from tasks file",
        "Returns null if no current story set"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement mark-complete command",
      "description": "As a developer, I need a mark-complete command to mark a story as passed and update state.",
      "acceptanceCriteria": [
        "Sets passes: true for specified story ID",
        "Clears .aimi/current-story",
        "Sets .aimi/last-result to success",
        "Uses atomic file update (temp file + mv)",
        "Outputs updated story JSON"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Implement mark-failed and mark-skipped commands",
      "description": "As a developer, I need commands to handle failure and skip scenarios.",
      "acceptanceCriteria": [
        "mark-failed <id> <notes> adds notes to story",
        "mark-failed sets last-result to failed",
        "mark-skipped <id> sets skipped: true",
        "mark-skipped sets last-result to skipped",
        "Both clear current-story state",
        "Both use atomic file updates"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement helper commands",
      "description": "As a developer, I need utility commands for metadata, counts, branch, and state operations.",
      "acceptanceCriteria": [
        "metadata returns only metadata object from tasks file",
        "count-pending returns number of pending stories",
        "get-branch returns branchName string",
        "get-state returns all state as JSON object",
        "clear-state removes all files in .aimi/"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Update execute.md to use CLI",
      "description": "As a developer, I need /aimi:execute updated to use aimi-cli.sh instead of inline jq.",
      "acceptanceCriteria": [
        "Replace inline jq with ./scripts/aimi-cli.sh calls",
        "Use init-session for setup",
        "Use count-pending for progress checks",
        "Use get-state for resumption after /clear",
        "Simpler, less error-prone command file"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Update next.md to use CLI",
      "description": "As a developer, I need /aimi:next updated to use aimi-cli.sh for story operations.",
      "acceptanceCriteria": [
        "Use next-story to get next pending story",
        "Use mark-complete on success",
        "Use mark-failed on failure",
        "Use mark-skipped when user skips",
        "Cleaner prompt generation without inline jq"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Update status.md to use CLI",
      "description": "As a developer, I need /aimi:status updated to use aimi-cli.sh status command.",
      "acceptanceCriteria": [
        "Single CLI call replaces all jq logic",
        "Parse JSON output for display formatting",
        "Simpler, more maintainable command file"
      ],
      "priority": 13,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Add .gitignore entry",
      "description": "As a developer, I need .aimi/ added to .gitignore so local state isn't committed.",
      "acceptanceCriteria": [
        "Add .aimi/ entry to project's .gitignore",
        "CLI warns if .aimi/ is not gitignored (optional enhancement)"
      ],
      "priority": 14,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Create test script",
      "description": "As a developer, I need a test script to validate CLI functionality.",
      "acceptanceCriteria": [
        "scripts/test-aimi-cli.sh exercises all commands",
        "Creates temporary tasks file for testing",
        "Validates output format and exit codes",
        "Cleans up after test"
      ],
      "priority": 15,
      "passes": true,
      "notes": ""
    }
  ]
}
